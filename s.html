<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Penyimpanan Barang Modern â€“ Supabase</title>

<style>
:root {
  --bg: #f3f4f6;
  --card: #ffffff;
  --accent: #2563eb;
  --accent-soft: #dbeafe;
  --text: #1f2937;
  --muted: #6b7280;
  --border: #e5e7eb;
  --success: #10b981;
  --danger: #ef4444;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 20px;
}

h1 {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 20px;
}

.toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}

input, select {
  padding: 10px 14px;
  font-size: 15px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: white;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 16px;
}

.slot-card {
  background: var(--card);
  border-radius: 18px;
  padding: 18px;
  min-height: 120px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.05);
  border: 2px solid transparent;
  transition: 0.2s;
  cursor: pointer;
}

.slot-card.empty {
  border-color: var(--border);
}

.slot-card.filled {
  background: var(--accent-soft);
  border-color: var(--accent);
}

.slot-id {
  font-weight: 700;
  font-size: 18px;
  color: var(--text);
}

.item-name {
  margin-top: 10px;
  font-size: 16px;
  font-weight: 600;
  color: var(--accent);
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.modal-content {
  background: white;
  padding: 20px;
  width: 90%;
  max-width: 500px;
  border-radius: 16px;
}

.modal-close {
  float: right;
  font-weight: bold;
  cursor: pointer;
  color: var(--muted);
}

.modal-close:hover {
  color: var(--text);
}

</style>
</head>
<body>

<h1>ðŸ“¦ Penyimpanan Barang â€“ Modern</h1>

<div class="toolbar">
  <select id="rackSelect"></select>
  <input type="text" id="searchInput" placeholder="ðŸ” Cari nama barang..." />
</div>

<div id="status">Mengambil data...</div>
<div id="grid" class="grid"></div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <span class="modal-close" id="modalClose">&times;</span>
    <h3 id="modalTitle"></h3>
    <p id="modalInfo"></p>
  </div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabase = createClient(
  "https://uusljhegkvahcjkaxqkz.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1c2xqaGVna3ZhaGNqa2F4cWt6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0ODMzMTIsImV4cCI6MjA3MDA1OTMxMn0.eio4OSjH30XzfXn-9UxQRVwleGKi2dvdWo6Ggx8FW1g"
);

const grid = document.getElementById("grid");
const status = document.getElementById("status");
const rackSelect = document.getElementById("rackSelect");
const searchInput = document.getElementById("searchInput");

const modal = document.getElementById("modal");
const modalClose = document.getElementById("modalClose");
const modalTitle = document.getElementById("modalTitle");
const modalInfo = document.getElementById("modalInfo");

let items = [];
let rackList = [];

function render() {
  grid.innerHTML = "";
  const query = searchInput.value.toLowerCase();
  const rak = rackSelect.value;

  const filtered = items.filter(x =>
    (x.item_name || "").toLowerCase().includes(query) &&
    (rak === "ALL" || x.rack === rak)
  );

  filtered.forEach(item => {
    const card = document.createElement("div");
    card.className = "slot-card " + (item.item_name ? "filled" : "empty");

    card.innerHTML = `
      <div class="slot-id">${item.slot}</div>
      <div class="item-name">${item.item_name ? item.item_name : "-"}</div>
    `;

    card.onclick = () => {
      modalTitle.textContent = item.item_name || "Slot Kosong";
      modalInfo.innerHTML = `
        <b>Slot:</b> ${item.slot}<br>
        <b>Rak:</b> ${item.rack}<br>
        <b>Diperbarui:</b> ${item.updated_at}
      `;
      modal.style.display = "flex";
    };

    grid.appendChild(card);
  });

  status.textContent = filtered.length + " slot ditampilkan";
}

modalClose.onclick = () => modal.style.display = "none";
window.onclick = e => { if (e.target === modal) modal.style.display = "none"; };

async function loadData() {
  status.textContent = "Mengambil data dari Supabase...";

  const { data, error } = await supabase.from("warehouse_items").select("*");

  if (error) {
    status.textContent = "âŒ Gagal mengambil data";
    return;
  }

  items = data;

  // Buat daftar rak
  rackList = [...new Set(data.map(x => x.rack))];
  rackSelect.innerHTML = `<option value="ALL">Semua Rak</option>`;
  rackList.forEach(r => {
    rackSelect.innerHTML += `<option value="${r}">Rak ${r}</option>`;
  });

  render();
}

rackSelect.onchange = render;
searchInput.oninput = render;

loadData();
</script>

</body>
</html>
