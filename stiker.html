<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Box Label Auto Print</title>

<style>
body {
    background: #ccc;
    font-family: Arial, Helvetica, sans-serif;
}

/* INPUT BARCODE */
.search {
    text-align: center;
    margin-top: 20px;
}

.search input {
    font-size: 20px;
    padding: 10px;
    width: 300px;
    text-align: center;
}

/* LABEL */
.label {
    width: 500px;
    height: 320px;
    background: #fff;
    padding: 20px 25px;
    box-sizing: border-box;
    border-radius: 6px;
    position: relative;
    margin: 20px auto;
    display: none; /* SEMBUNYI DI LAYAR */
}

.no {
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 15px;
}

.content {
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-line;
}

.weights {
    position: absolute;
    bottom: 20px;
    left: 25px;
    font-size: 16px;
    font-weight: bold;
}

.page {
    position: absolute;
    bottom: 20px;
    right: 95px;
    font-size: 24px;
    font-weight: bold;
}

/* ===== PRINT MODE ===== */
@media print {
    body * {
        display: none !important;
    }

    .label {
        display: block !important;
        position: absolute;
        top: 0;
        left: 0;
    }
}
</style>
</head>

<body>

<!-- INPUT BARCODE -->
<div class="search">
    <div style="font-size:18px;font-weight:bold;margin-bottom:8px;">
        SCAN BARCODE
    </div>
    <input id="barcodeInput" autofocus>
</div>

<!-- LABEL -->
<div class="label" id="label">
    <div class="no" id="labelNo">NO:</div>
    <div class="content" id="content"></div>
    <div class="weights" id="weights"></div>
    <div class="page" id="pageNo"></div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
/* =============================
   SUPABASE CONFIG
============================= */
const SUPABASE_URL = "https://uusljhegkvahcjkaxqkz.supabase.co";
const SUPABASE_KEY = "YOUR_SUPABASE_ANON_KEY";

const supabaseClient = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
);

/* =============================
   SCAN BARCODE (ENTER)
============================= */
const barcodeInput = document.getElementById("barcodeInput");

barcodeInput.addEventListener("keydown", e => {
    if (e.key === "Enter") {
        e.preventDefault();
        const code = barcodeInput.value.trim();
        if (code) loadByBarcode(code);
    }
});

/* =============================
   LOAD & AUTO PRINT
============================= */
async function loadByBarcode(barcode) {

    const { data, error } = await supabaseClient
        .from("box_labels")
        .select("*")
        .eq("barcode", barcode)
        .single();

    if (error || !data) {
        alert("Label tidak ditemukan");
        barcodeInput.value = "";
        barcodeInput.focus();
        return;
    }

    // ISI LABEL
    document.getElementById("labelNo").innerText =
        "NO: " + data.label_no;

    document.getElementById("content").innerText =
`${data.part1}
${data.desc1}
${data.part2}
${data.desc2}`;

    document.getElementById("weights").innerHTML =
`G.W.: ${data.gross_weight} Kgs<br>
N.W.: ${data.net_weight} Kgs`;

    document.getElementById("pageNo").innerText =
        data.page_no;

    document.getElementById("label").style.display = "block";

    // AUTO PRINT (TANPA REVIEW)
    setTimeout(() => {
        window.print();
        barcodeInput.value = "";
        barcodeInput.focus();
    }, 100);
}
</script>

</body>
</html>
