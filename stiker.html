<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auto Print Label</title>

<style>
body {
  font-family: Arial;
  background: #eee;
}

input {
  font-size: 22px;
  padding: 10px;
  width: 300px;
}

.label {
  width: 500px;
  height: 320px;
  background: #fff;
  padding: 20px;
  margin-top: 20px;
  border: 1px solid #000;
}

@media print {
  body * {
    display: none;
  }
  .label {
    display: block;
  }
}
</style>
</head>

<body>

<h3>SCAN BARCODE</h3>
<input id="barcode" autofocus>

<div class="label" id="label">
  <div id="no"></div>
  <pre id="content"></pre>
  <div id="weight"></div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const supabase = supabaseJs.createClient(
  "https://uusljhegkvahcjkaxqkz.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1c2xqaGVna3ZhaGNqa2F4cWt6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0ODMzMTIsImV4cCI6MjA3MDA1OTMxMn0.eio4OSjH30XzfXn-9UxQRVwleGKi2dvdWo6Ggx8FW1g"
);

const barcodeInput = document.getElementById("barcode");
let isPrinting = false; // ðŸ”’ anti double print

barcodeInput.addEventListener("keydown", async (e) => {
  if (e.key !== "Enter") return;

  const code = barcodeInput.value.trim();
  if (!code || isPrinting) return;

  const { data, error } = await supabase
    .from("box_labels")
    .select("*")
    .eq("barcode", code)
    .single();

  if (error || !data) {
    alert("Data tidak ditemukan");
    barcodeInput.value = "";
    return;
  }

  document.getElementById("no").innerText = "NO: " + data.label_no;
  document.getElementById("content").innerText =
`${data.part1}
${data.desc1}
${data.part2}
${data.desc2}`;

  document.getElementById("weight").innerText =
`G.W ${data.gross_weight} | N.W ${data.net_weight}`;

  isPrinting = true;

  // ðŸ–¨ï¸ AUTO PRINT (AMAN)
  setTimeout(() => {
    window.print();
  }, 300);

  barcodeInput.value = "";
});

window.onafterprint = () => {
  isPrinting = false;
  barcodeInput.focus();
};
</script>

</body>
</html>
